FROM alpine:latest AS staging

RUN apk update
RUN apk add git python2 py2-pip py2-yaml py2-certifi py2-chardet py2-idna py2-requests py2-urllib3
RUN git clone https://github.com/epinna/tplmap /tplmap \
    && rm -rf /tplmap/.git

FROM alpine:latest

RUN apk add --no-cache python2

COPY --from=staging /usr/lib/python2.7/site-packages /usr/lib/python2.7/site-packages
COPY --from=staging /tplmap /tplmap
RUN ln -s /tplmap/tplmap.py /usr/local/bin/tplmap

ENTRYPOINT ["tplmap"]
