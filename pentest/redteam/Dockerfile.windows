FROM pentest-base

# Install common reconnaissance tools
RUN apt-get install -y \
    nmap \
    ncat \
    arp-scan \
    netdiscover

# Install common cracking tools
RUN apt-get install -y \
    wordlists \
    hydra \
    john

# Install common auxiliary tools
# RUN apt-get install -y \
#     exploitdb \
#     weevely \
#     webshells \
#     hash-identifier \
#     findmyhash

# Add Microsoft apt repository
RUN curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -

# Install powershell
RUN echo "deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-debian-jessie-prod jessie main" > /etc/apt/sources.list.d/powershell.list \
    && apt-get update \
    && apt-get install -y powershell \
    && pwsh -c "Update-Help"

# Install MSSQL common tools
RUN curl https://packages.microsoft.com/config/ubuntu/16.04/prod.list | tee /etc/apt/sources.list.d/msprod.list \
    && apt-get update \
    && apt-get install -y mssql-tools unixodbc-dev
    && echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc

# Install common Windows lateral movement tools
RUN apt-get install -y \
        crackmapexec \
        kerberoast \
        mimikatz \
        passing-the-hash \
        redsnarf \
        responder \
        powersploit \
        nishang \
    && pip install --no-cache-dir impacket

# Install common Windows weaponization tools
RUN git clone https://github.com/peewpw/Invoke-PSImage.git /scripts/Invoke-PSImage \
    && git clone https://github.com/mwrlabs/wePWNise /scripts/wePWNise

# Create known_hosts for git cloning
RUN mkdir -p /root/.ssh \
    && touch /root/.ssh/known_hosts
# Add host keys
RUN ssh-keyscan bitbucket.org >> /root/.ssh/known_hosts
RUN ssh-keyscan github.com >> /root/.ssh/known_hosts

EXPOSE 80/tcp 443/tcp
WORKDIR /root
ENTRYPOINT ["/usr/bin/zsh"]
