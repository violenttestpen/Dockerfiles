FROM debian:jessie

# Add Kali repositories
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ED444FF07D8D0BF6
RUN echo deb http://kali.cs.nctu.edu.tw/kali kali-rolling main contrib non-free > /etc/apt/sources.list \
    && echo deb-src http://kali.cs.nctu.edu.tw/kali kali-rolling main contrib non-free >> /etc/apt/sources.list \
    && apt-get update

# Use a more reliable mirror
# RUN sed -i 's/http.kali.org/kali.cs.nctu.edu.tw/g' /etc/apt/sources.list \
#     && apt-get update

# Install common tools
RUN apt-get install -y \
    net-tools \
    man-db \
    vim less \
    ca-certificates git curl \
    zip unzip \
    openssh-client

# Install common runtime languages
RUN apt-get install -y \
    python python-pip \
    python3 python3-pip

# Install metasploit-framework
RUN apt-get install -y metasploit-framework

# Install pwntools
RUN pip install --no-cache-dir pwntools

# Install debugging tools
RUN apt-get install -y \
    gdb

# Install gdb-peda
RUN git clone https://github.com/longld/peda.git /opt/peda \
    && echo "source /opt/peda/peda.py" >> ~/.gdbinit

# Install hexeditor
RUN git clone https://github.com/b3ad/hexeditor.git /opt/hexeditor \
    && chmod +x /opt/hexeditor/hexeditor \
    && ln -s /opt/hexeditor/hexeditor /usr/local/bin/hexeditor

# Install auxiliary tools
RUN apt-get install -y \
    binwalk \
    foremost \
    vbindiff

# Add 32-bit architecture support
RUN dpkg --add-architecture i386 \
    && apt-get update

# Add checksec.sh
RUN apt-get install -y dos2unix \
    && wget http://www.trapkit.de/tools/checksec.sh -O - | dos2unix > /usr/local/bin/checksec \
    && chmod +x /usr/local/bin/checksec

# Add frida
RUN pip3 install --no-cache-dir frida

WORKDIR /root
