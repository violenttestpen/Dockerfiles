FROM pentest-base

# Install common reconnaissance tools
RUN apt-get install -y \
    nmap \
    ncat \
    arp-scan \
    netdiscover

# Install common cracking tools
RUN apt-get install -y \
    wordlists \
    hydra \
    john

# Install common auxiliary tools
RUN apt-get install -y \
    exploitdb \
    weevely \
    webshells \
    hash-identifier \
    findmyhash

# Install powershell
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ED444FF07D8D0BF6 \
    && echo "deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-debian-jessie-prod jessie main" > /etc/apt/sources.list.d/powershell.list \
    && apt update \
    && apt-get install -y powershell \
    && pwsh -c "Update-Help"

# Install common Windows lateral movement tools
RUN apt-get install -y \
    crackmapexec \
    powersploit \
    nishang
RUN pip install --no-cache-dir impacket

# Create known_hosts for git cloning
RUN mkdir -p /root/.ssh \
    && touch /root/.ssh/known_hosts
# Add host keys
RUN ssh-keyscan bitbucket.org >> /root/.ssh/known_hosts
RUN ssh-keyscan github.com >> /root/.ssh/known_hosts

EXPOSE 80/tcp 443/tcp
WORKDIR /root
ENTRYPOINT ["/usr/bin/zsh"]
